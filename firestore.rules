rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // --- FUNÇÕES DE SEGURANÇA ---

    // 1. É o CEO? (Autoridade Máxima - Bypass)
    // Verifica se é o seu UID Específico OU o seu E-mail (Dupla checagem)
    function isCEO() {
      return request.auth != null && (
        request.auth.uid == "o0FzqC1oYoYYwjgJXbbgL4QoCe42" || 
        request.auth.token.email == "louisfelipecabral@gmail.com"
      );
    }

    // 2. É da Equipe? (Qualquer logado)
    function isStaff() {
      return request.auth != null;
    }

    // --- REGRAS ---

    // REGRA DE OURO: O CEO pode ler e escrever em TUDO (Bypass Global)
    // Isso resolve o erro de permissão na listagem de usuários.
    match /{document=**} {
      allow read, write: if isCEO();
    }

    // Coleção de Usuários
    match /users/{userId} {
      // CEO já tem acesso pela regra acima.
      // O próprio usuário pode ler/escrever seus dados.
      // Staff pode ler (necessário para o sistema carregar nomes, etc).
      allow read: if isStaff(); 
      allow write: if request.auth.uid == userId;
    }
    
    // Coleção de Produtos/Vendas/etc (Genérica para Staff)
    match /products/{productId} {
      allow read: if true; // Público (Cardápio)
      allow write: if isStaff(); // Funcionários vendem
    }
    
    // Adicione outras coleções conforme necessário...
  }
}